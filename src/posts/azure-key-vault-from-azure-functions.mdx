---
title: "Azure Key Vault From Azure Functions"
slug: "azure-key-vault-from-azure-functions"
date: "2017-05-01T00:00:00.000Z"
feature_image: "/images/azureFunction_createFunction.png"
tags: ["Azure"]
---

_[Azure Functions](https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview) is a solution for easily running small pieces of code, or "functions," in the cloud. You can write just the code you need for the problem at hand, without worrying about a whole application or the infrastructure to run it. Functions can make development even more productive, and you can use your development language of choice, such as C#, F#, Node.js, Python or PHP. Pay only for the time your code runs and trust Azure to scale as needed. Azure Functions lets you develop serverless applications on Microsoft Azure._

Even when developing with Azure Functions you want to keep your sensitive data protected. Like for example if the function needs to connect to a database you might want to get the connection string from [Azure Key Vault](/posts/getting-started-with-azure-key-vault/). If you are new to Azure Key Vault check out [these posts to get started](/blog/tag/azure-key-vault/). In this post, we will explore how we can consume objects in Azure Key Vault from an Azure Function.

**Create Azure Function App**: Let's first create an Azure Function App from the Azure portal. Under _New - Compute - Function App_ you can create a new Azure Function.

![](/images/azureFunction_new.png)

Enter the details of the new function app and press Create. Each function app has an associated storage account. You can choose an existing one or create a new one.

![](/images/azureFunction_create.png)

You can view all Azure Functions Apps in the subscription under _More services - Function Apps_

![](/images/azureFunction_all.png)

**Create Function**: To create a function you can create from an existing template or create a custom function. In this example, I will use a timer based function in C#.

![](/images/azureFunction_createFunction.png)

In the _run.csx_ file add in the code for the function. The below code fetches the secret value from the Key Vault and logs it. You need to provide the [Azure AD Application Id and secret](/posts/authenticating-a-client-application-with-azure-key-vault/) to authenticate with it. Alternatively you can also use [certificate based authentication to authenticate with the Key Vault](/posts/azure-key-vault-from-azure-functions-certificate-based-authentication/). Make sure you add in the relevant _using_ statements for the KeyVault client Azure Active Directory Authentication libraries (ADAL).

```csharp
using System;
using Microsoft.Azure.KeyVault;
using Microsoft.IdentityModel.Clients.ActiveDirectory;
```
    
```csharp
private const string applicationId = "AD Application Id";
private const string applicationSecret = "AD Application Secret";
```
    
```csharp
public async static Task Run(TimerInfo myTimer, TraceWriter log)
{
```
        var keyClient = new KeyVaultClient(async (authority, resource, scope) =>
        {
            var adCredential = new ClientCredential(applicationId, applicationSecret);
            var authenticationContext = new AuthenticationContext(authority, null);
            return (await authenticationContext.AcquireTokenAsync(resource, adCredential)).AccessToken;
        });
    
        var secretIdentifier = "https://rahulkeyvault.vault.azure.net/secrets/mySecretName";
        var secret = await keyClient.GetSecretAsync(secretIdentifier);
    
        log.Info($"C# Timer trigger function executed at: {secret}");
    }
    

![](/images/azureFunction_code.png)

Since the KeyVaultClient and the ADAL libraries are NuGet packages, we need to specify these as dependencies for the Azure Function. To use NuGet packages, create a _project.json_ file in the functions folder. Add in both the NuGet packages name and required version.

    {
      "frameworks": {
        "net46": {
          "dependencies": {
            "Microsoft.Azure.KeyVault": "1.0.0",
            "Microsoft.IdentityModel.Clients.ActiveDirectory": "2.14.201151115"
          }
        }
      }
    }
    

![](/images/azureFunction_nuget.png)

Executing the function, retrieves the secret details from the Key Vault and logs it as shown below.

![](/images/azureFunction_run.png)

Hope this helps you to get started with Key Vault in Azure Functions and keep your sensitive data secure.